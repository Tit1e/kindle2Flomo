(function(t){function e(e){for(var n,a,c=e[0],l=e[1],r=e[2],d=0,p=[];d<c.length;d++)a=c[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(p.length)p.shift()();return s.push.apply(s,r||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,c=1;c<i.length;c++){var l=i[c];0!==o[l]&&(n=!1)}n&&(s.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},o={app:0},s=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=e,c=c.slice();for(var r=0;r<c.length;r++)e(c[r]);var u=l;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"1ccb":function(t,e,i){"use strict";i("b8b9")},"3cd6":function(t,e,i){},"56d1":function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{id:"app","element-loading-text":t.loadingText}},[i("options",{attrs:{list:t.contentList,"tmp-list":t.tmpList},on:{submit:t.submit,parse:t.confirmFirstParse,reverse:t.reverseList,"list-update":t.listUpdate,"update-tag":t.updateTag,reset:t.reset}}),i("div",{staticClass:"editor radio flex-v"},[i("selected-text",{attrs:{selected:t.checkedMemo.length,total:t.contentList.length,"import-count":t.importCount,disabled:t.disabled},on:{change:t.checkAllChange}}),i("div",{staticClass:"flex-1 overauto"},[i("draggable",t._b({staticClass:"list-group",attrs:{tag:"ul",disabled:t.dragDisabled},on:{start:function(e){t.drag=!0},end:function(e){t.drag=!1}},model:{value:t.contentList,callback:function(e){t.contentList=e},expression:"contentList"}},"draggable",t.dragOptions,!1),[i("transition-group",{attrs:{type:"transition",name:t.drag?null:"flip-list"}},t._l(t.contentList,(function(e,n){return i("content-card",{key:e.text,staticClass:"list-group-item",attrs:{input:e.text,check:e.checked,edit:e.isEdit,info:e,disabled:t.disabled},on:{"update:input":function(i){return t.$set(e,"text",i)},"update:check":function(i){return t.$set(e,"checked",i)},"update:edit":function(i){return t.$set(e,"isEdit",i)}}})})),1)],1)],1)],1)],1)},s=[],a=i("ade3"),c=(i("4de4"),i("99af"),i("d81d"),i("ac1f"),i("1276"),i("a15b"),i("6829")),l=i.n(c),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"content-card"},[i("div",{staticClass:"checkbox"},[i("label",{staticClass:"label",class:t.disabled?"disabled":""},[i("i",{staticClass:"el-icon-success",class:t.checked?"active":""}),i("el-checkbox",{attrs:{disabled:t.disabled},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}})],1)]),i("div",{staticClass:"priview radio",on:{dblclick:t.handleEdit}},[t.isEdit?[i("el-input",{attrs:{type:"textarea",autosize:"",rows:5},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),i("div",{staticClass:"pt-10 text-right"},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.submit}},[t._v("完成")])],1)]:i("pre",[t._v(t._s(t.content))])],2)])},u=[],d={name:"ContentCard",props:{info:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1}},data:function(){return{content:this.info.text,checked:this.info.checked,isEdit:this.info.isEdit}},watch:{info:{handler:function(t){var e=t.checked,i=t.text,n=t.isEdit;this.content=i,this.checked=e,this.isEdit=n},deep:!0},isEdit:function(t){this.$emit("update:edit",t)},checked:function(t){this.$emit("update:check",t)}},methods:{handleEdit:function(){var t=this,e=localStorage.getItem("canDrag")||"0";"0"===e?this.$alert("有 MEMO 在编辑模式时，列表无法进行拖动排序。","提示",{confirmButtonText:"知道了，不再提示",callback:function(e){localStorage.setItem("canDrag","1"),t.$emit("update:edit",!0)}}):this.$emit("update:edit",!0)},submit:function(){this.$emit("update:edit",!1),this.$emit("update:input",this.content)}}},p=d,f=(i("daba"),i("2877")),h=Object(f["a"])(p,r,u,!1,null,"8e15e820",null),m=h.exports,g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"options radio"},[i("div",{staticClass:"top"},[i("el-form",{ref:"form",attrs:{model:t.options,"label-width":"80px",size:"mini","label-suffix":"：","label-position":"top"}},[i("el-form-item",{attrs:{label:"Api"}},[i("el-input",{attrs:{type:"password","show-password":"",placeholder:"API 采用本地存储"},model:{value:t.options.api,callback:function(e){t.$set(t.options,"api",e)},expression:"options.api"}})],1),i("el-form-item",{attrs:{"label-width":"0"}},[i("el-upload",{staticStyle:{width:"100%"},attrs:{id:"fileSelect","show-file-list":!1,multiple:!1,action:"","auto-upload":!1,accept:".html,.txt"}},[i("div",{staticClass:"upload-content radio flex pd-10"},[i("i",{staticClass:"el-icon-folder-add"}),i("div",{staticClass:"el-upload__text"},[t._v(" 选择 HTML / TXT 文件 ")])])]),i("div",{staticClass:"how"},[i("i",{staticClass:"el-icon-question"}),i("a",{attrs:{href:"https://mp.weixin.qq.com/s/CPIYoGItJVWJGk30MoVNXA",target:"_blank"}},[t._v("如何导出 HTML？")]),i("el-tooltip",{attrs:{effect:"dark",placement:"bottom"}},[i("div",{attrs:{slot:"content"},slot:"content"},[i("div",{staticClass:"pb-10"},[t._v(" 将 Kindle 通过数据线连接至电脑 ")]),i("div",[t._v(" 文件位于：Kindle根目录 - document - My Clippings.txt ")])]),i("span",[t._v("My Clippings.txt 在哪？")])])],1)],1),t.bookList.length?i("el-form-item",{attrs:{label:"选择书籍"}},[i("el-select",{on:{change:t.selectChange},model:{value:t.options.book,callback:function(e){t.$set(t.options,"book",e)},expression:"options.book"}},t._l(t.bookList,(function(t,e){return i("el-option",{key:t.index,attrs:{label:t.title,value:t.title}})})),1)],1):t._e(),i("el-form-item",{attrs:{label:"书名"}},[i("el-input",{attrs:{clearable:""},model:{value:t.options.title,callback:function(e){t.$set(t.options,"title",e)},expression:"options.title"}})],1),i("el-form-item",{attrs:{label:"Tag"}},[i("div",{staticClass:"flex"},[i("div",{staticClass:"flex-1"},[i("el-input",{attrs:{disabled:t.options.noTag,clearable:""},model:{value:t.options.tag,callback:function(e){t.$set(t.options,"tag",e)},expression:"options.tag"}})],1),i("div",{staticClass:"flex-1 pl-10"},[i("el-checkbox",{model:{value:t.options.noTag,callback:function(e){t.$set(t.options,"noTag",e)},expression:"options.noTag"}},[t._v("隐藏 tag")])],1)])]),t.options.noTag?t._e():[i("el-form-item",{attrs:{label:"Tag 位置"}},[i("el-switch",{attrs:{"active-text":"顶部","inactive-text":"底部"},model:{value:t.options.tagPosition,callback:function(e){t.$set(t.options,"tagPosition",e)},expression:"options.tagPosition"}})],1),i("el-form-item",{attrs:{label:"tag 示例"}},[i("el-tag",{attrs:{size:"small"}},[t._v(" "+t._s(t.tag)+" ")])],1)],i("el-form-item",{attrs:{label:""}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"left"}},[i("div",{staticStyle:{width:"200px","line-height":"1.5em"},attrs:{slot:"content"},slot:"content"},[t._v(" 如导入内容含有自己添加的笔记，请使用移动端 APP 导出 HTML 或 My Clippings.txt ")]),i("i",{staticClass:"el-icon-warning"})]),t._v(" 笔记位置： ")],1),i("el-switch",{attrs:{"active-text":"摘录上方","inactive-text":"摘录下方"},model:{value:t.options.notePosition,callback:function(e){t.$set(t.options,"notePosition",e)},expression:"options.notePosition"}})],1),i("el-form-item",{attrs:{label:"分隔符"}},[i("el-input",{attrs:{clearable:""},model:{value:t.options.split,callback:function(e){t.$set(t.options,"split",e)},expression:"options.split"}}),i("span",{staticClass:"fz-12"},[t._v("分隔符总是在笔记与摘录之间")])],1),i("el-form-item",{attrs:{label:"列表顺序"}},[i("el-switch",{attrs:{"active-text":"倒序","inactive-text":"顺序"},on:{change:t.reverse},model:{value:t.options.reverse,callback:function(e){t.$set(t.options,"reverse",e)},expression:"options.reverse"}})],1)],2)],1),i("div",{staticClass:"bottom"},[i("el-button",{attrs:{type:"primary",size:"mini",disabled:!t.tmpList.length},on:{click:t.parse}},[t._v("解析")]),i("el-button",{attrs:{type:"primary",disabled:t.disabledSend,size:"mini"},on:{click:t.submit}},[t._v("导入 Flomo")])],1)])},b=[],v=i("5530"),x=(i("7db0"),i("b0c0"),i("498a"),i("a630"),i("3ca3"),i("53ca"));i("5319"),i("159b"),i("c740");function k(t){var e=Object(x["a"])(t);return"function"===e||"object"===e&&!!t}function C(t){if(!k(t))return t;for(var e,i,n=1,o=arguments.length;n<o;n++)for(i in e=arguments[n],e)t[i]=e[i];return t}function _(t){return-1!==t.indexOf("标注")?1:-1!==t.indexOf("笔记")||-1!==t.indexOf("书签")?2:void 0}var y={split_created:function(t){t=t.split("|").map((function(t){return t.trim()}));try{var e=/添加于\s+(\d{4})年(\d+)月(\d+)日.*(上|下)午(\d+):(\d+):(\d+)$/,i=e.exec(t[1]),n=+i[5],o="上"===i[4]?n:n+12===24?0:n+12,s=i[6],a=i[7],c=t[0].substr(2),l=c.replace(/[^0-9]/gi,""),r=_(c);return{type:r,position:1===r?c:l,note:"",date:new Date(i[1]+" "+i[2]+" "+i[3]+" "+o+":"+s+":"+a)}}catch(u){return{note:"",position:"",date:""}}},split_book:function(t){t=t.replace(/（/g,"(").replace(/）/g,")");try{var e=/(.+)\((.+)\)/,i=e.exec(t);return{book:i[1].trim(),author:i[2].trim()}}catch(n){console.log(n)}}};function w(t){this.position="",this.book="",this.author="",this.date=null,this.content="",this.texts=t,this.type="",this.init()}function O(t){t=t.split("==========").filter((function(t){return t}));var e=[],i=[];t.map($).forEach((function(t){t&&(1===t.type&&t.content&&i.push(t),2===t.type&&t.content&&e.push(t))})),e.forEach((function(t){var e=i.findIndex((function(e){return-1!==e.position.indexOf(t.position)}));-1!==e&&(i[e].note=t.content)}));var n=[];return i.forEach((function(t){var e=n.findIndex((function(e){return e.title===t.book}));-1!==e?n[e].texts.push({text:t.content,note:t.note,checked:!1,isEdit:!1}):n.push({title:t.book,texts:[{text:t.content,note:t.note,checked:!1,isEdit:!1}]})})),console.log(n),n.reverse()}function $(t){return t=t.trim(),t?new w(t):null}w.prototype.init=function(){var t=this.texts.split("\r\n").filter((function(t){return t})),e=null;e=y.split_book(t[0]),C(this,e),t[1]&&(e=y.split_created(t[1]),C(this,e)),this.content=t[2],e=null};var T=O,L=i("1431");function M(t){var e=L.load(t),i=e(".bookTitle")[0],n=e(i).text().trim(),o=[],s=Array.from(e(".noteText")),a=[];while(s.length){var c=s.pop(),l=_(c.prev.prev.children[0].data),r=c.children.filter((function(t){return"text"===t.type})).map((function(t){return t.data.trim()})).join("");2===l&&a.push(r),1===l&&o.unshift({text:r,note:a.pop()||"",checked:!1,isEdit:!1})}return{title:n,texts:o}}var S=M,E={name:"Options",props:{list:{type:Array,default:function(){return[]}},tmpList:{type:Array,default:function(){return[]}}},data:function(){return{options:{book:"",title:"",split:"",tag:"kindle",api:"",noTag:!1,reverse:!1,tagPosition:!1,notePosition:!1},tag:"",bookList:[]}},watch:{options:{handler:function(){this.computedTag()},deep:!0,immediate:!0}},computed:{checkedMemo:function(){return this.list.filter((function(t){return t.checked}))},disabledSend:function(){return!this.checkedMemo.length||!this.options.api}},created:function(){this.setOptions()},mounted:function(){var t=this;this.$nextTick((function(){t.listenFile()}))},methods:{selectChange:function(t){var e=this.bookList.find((function(e){return e.title===t}));this.updateData(e)},parse:function(){this.updateOptions(),this.$emit("parse",this.options)},submit:function(){this.$emit("submit",this.options.api)},reverse:function(){this.$emit("reverse")},setOptions:function(){var t=JSON.parse(localStorage.getItem("options"));this.$set(this,"options",Object(v["a"])(Object(v["a"])({},this.options),t))},reset:function(){this.bookList=[],this.$emit("reset")},listenFile:function(){var t=this;document.querySelector("#fileSelect input").addEventListener("change",(function(e){t.reset(),t.$nextTick((function(){var i=e.target.files[0],n=i.name.split(".").pop().toLowerCase(),o=new FileReader;o.onload=function(){if("txt"===n){t.bookList=T(o.result);try{var e=t.bookList[0];t.options.book=e.title,t.updateData(e)}catch(s){}}if("html"===n){var i=S(o.result);t.updateData(i)}},o.readAsText(i)}))}))},updateData:function(t){var e=t.title,i=t.texts;this.options.title=e,this.$emit("list-update",i),i.length?this.parse():this.$message.warning("未发现有效内容")},updateOptions:function(){var t=this.options,e=t.noTag,i=t.api,n=t.tag,o=t.split,s=t.tagPosition,a=t.reverse,c={noTag:e,api:i,tag:n,split:o,tagPosition:s,reverse:a};localStorage.setItem("options",JSON.stringify(c))},computedTag:function(){var t="",e=this.options,i=e.tag,n=e.title,o=e.noTag;if(o)return this.$emit("update-tag",t),this.tag=t,!1;t=i?"#".concat(i,"/").concat(n):"#".concat(n),this.$emit("update-tag",t),this.tag=t}}},P=E,j=(i("7ebd"),Object(f["a"])(P,g,b,!1,null,"951383fa",null)),I=j.exports,A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"selected-text radio flex"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"left"}},[i("div",{staticStyle:{width:"200px","line-height":"1.5em"},attrs:{slot:"content"},slot:"content"},[t._v(" 未经审视的生活不值得过，未经审视的思想也不应该汇入你的大脑。建议在导入前审视一遍内容。 ")]),i("div",{staticClass:"checkbox"},[i("label",{staticClass:"label",class:t.disabled?"disabled":""},[i("i",{staticClass:"el-icon-success",class:t.checkAll?"active":""}),i("el-checkbox",{attrs:{disabled:t.disabled},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}})],1)])]),i("div",{staticClass:"flex-1"},[t._v(" 已选择 "),i("span",{staticClass:"highlight"},[t._v(t._s(t.selected))]),t._v(" 条 MEMO，共 "),i("span",{staticClass:"highlight"},[t._v(t._s(t.total))]),t._v(" 条。今天已导入 "),i("span",{staticClass:"highlight"},[t._v(t._s(t.importCount))]),t._v(" 条 MEMO "),i("a",{staticClass:"thanks",attrs:{href:"https://mp.weixin.qq.com/s/o793lUsBaWc61fLZzFDlxg",target:"_blank"}},[t._v(" 感谢 LP 的授权 ")])]),i("div",[i("el-dropdown",[i("span",[t._v(" 关于作者 ")]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[i("a",{attrs:{href:"https://evolly.one",target:"_blank"}},[t._v("博客")])]),i("el-dropdown-item",[i("a",{attrs:{href:"https://album.animalcrossing.life",target:"_blank"}},[t._v("Tit1e's Photo Studio")])]),i("el-dropdown-item",[i("a",{attrs:{href:"https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2021-05-23-IMG_8849.PNG",target:"_blank"}},[i("img",{attrs:{src:"https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2021-05-23-IMG_8849.PNG",width:"200px",alt:"即刻"}})])])],1)],1)],1)],1)},D=[],N=(i("a9e3"),{name:"SelectedText",props:{selected:{type:Number,default:0},total:{type:Number,default:0},disabled:{type:Boolean,default:!1},importCount:{type:Number,default:0}},data:function(){return{checkAll:!1}},watch:{checkAll:function(t){this.$emit("change",t)}},methods:{}}),J=N,q=(i("1ccb"),Object(f["a"])(J,A,D,!1,null,"557838ae",null)),z=q.exports,F=i("b76a"),B=i.n(F),G={name:"app",components:{ContentCard:m,Options:I,SelectedText:z,draggable:B.a},filters:{},data:function(){return{date:"",contentList:[],tmpList:[],index:0,loading:!1,tag:"",drag:!1,dragOptions:{animation:200},importCount:0}},watch:{importCount:function(t){localStorage.setItem("importCount",JSON.stringify(Object(a["a"])({},this.date,t)))}},computed:{dragDisabled:function(){return!!this.contentList.filter((function(t){return t.isEdit})).length},disabled:function(){return this.checkedMemo.length>=100},checkedMemo:function(){return this.contentList.filter((function(t){return t.checked}))},loadingText:function(){return"为减轻服务器压力，导入间隔为 1s。导入进度： ".concat(this.index+1,"/").concat(this.checkedMemo.length)}},created:function(){this.date=this.setDate(),this.geImportCount(this.date)},methods:{checkAllChange:function(t){this.contentList=this.contentList.map((function(e,i){return t&&i<=99?(e.checked=!0,e):(e.checked=!1,e)}))},updateTag:function(t){this.tag=t},listUpdate:function(t){this.tmpList=t},sendMemo:function(t,e,i){var n=this,o={content:e[i].text};l.a.post(t,o).then((function(o){n.importCount+=1,i<e.length-1?setTimeout((function(){n.index+=1,n.sendMemo(t,e,n.index)}),1e3):(n.$message.success("导入完毕"),n.loading=!1)})).catch((function(t){n.loading=!1,console.error(t),n.$message.error("记录失败")}))},submit:function(t){this.loading=!0,this.index=0,this.sendMemo(t,this.checkedMemo,this.index)},confirmCanEdit:function(t){var e=this,i=localStorage.getItem("canEdit")||"0";"0"===i&&this.$alert("双击 MEMO 可进入编辑模式","提示",{confirmButtonText:"知道了，不再提示",callback:function(i){localStorage.setItem("canEdit","1"),e.parse(t)}})},confirmFirstParse:function(t){var e=this,i=localStorage.getItem("hasConfirm")||"0";"0"===i?this.$alert("每次修改“书名”、“Tag”、“Tag 位置”、“分隔符”后需重新解析才会生效，重新解析会还原编辑后的内容。","提示",{confirmButtonText:"知道了，不再提示",callback:function(i){localStorage.setItem("hasConfirm","1"),e.parse(t)}}):this.parse(t)},parse:function(t){var e=this,i=t.split,n=t.tagPosition,o=t.notePosition;this.contentList=[],this.$nextTick((function(){e.contentList=JSON.parse(JSON.stringify(e.tmpList)).map((function(t){var s=t.note?[t.text,i,t.note]:[t.text,i];return o&&s.reverse(),n?s.unshift(e.tag):s.push(e.tag),t.text=s.filter((function(t){return t})).join("\r\n\r\n"),t})),e.confirmCanEdit(t)}))},reverseList:function(){this.contentList.reverse()},reset:function(){this.contentList=[],this.tmpList=[]},setDate:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,n=t.getDate();return"".concat(e).concat(i).concat(n)},geImportCount:function(t){var e=JSON.parse(localStorage.getItem("importCount")||"{}");this.importCount=+e[t]||0}}},H=G,U=(i("abb8"),Object(f["a"])(H,o,s,!1,null,null,null)),K=U.exports,V=i("5c96"),W=i.n(V);i("0fae");n["default"].use(W.a);i("3cd6"),i("9536");n["default"].config.productionTip=!1,new n["default"]({render:function(t){return t(K)}}).$mount("#app")},"7ebd":function(t,e,i){"use strict";i("e25f")},9536:function(t,e,i){},abb8:function(t,e,i){"use strict";i("56d1")},b8b9:function(t,e,i){},daba:function(t,e,i){"use strict";i("e4ca")},e25f:function(t,e,i){},e4ca:function(t,e,i){}});
//# sourceMappingURL=app.883423ea.js.map